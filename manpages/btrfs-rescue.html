<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.5">
    <meta name="project" content="Manpages v2.1.1">

    <title>btrfs-rescue — Manpages v2.1.1</title>
    <link rel="stylesheet" href="dist/elixir-64c5e2b63575bddb1c5b.css" />

    <script src="dist/sidebar_items-57a159ecb1.js"></script>

      <script src="doc-versions.js"></script>

    <script async src="dist/app-b5f3440501744dc8be3d.js"></script>

<link rel="stylesheet" href="assets/doc.css">
  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="https://kaisenlinux.org/manpages/">
        <img src="assets/logo.jpg" alt="Manpages" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="https://kaisenlinux.org/manpages/" class="sidebar-projectName" translate="no">
Manpages
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v2.1.1
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">MANUALS</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


  <span>btrfs-rescue</span>
</h1>

<p>BTRFS-RESCUE(8)                                                                            BTRFS                                                                           BTRFS-RESCUE(8)</p><p>NAME</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">btrfs</span><span class="o">-</span><span class="k">rescue</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">recover</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">damaged</span><span class="w"> </span><span class="n">btrfs</span><span class="w"> </span><span class="n">filesystem</span></code></pre><p>SYNOPSIS</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">btrfs</span><span class="w"> </span><span class="k">rescue</span><span class="w"> </span><span class="o">&lt;</span><span class="n">subcommand</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">args</span><span class="o">&gt;</span></code></pre><p>DESCRIPTION</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">btrfs</span><span class="w"> </span><span class="k">rescue</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">recover</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">damaged</span><span class="w"> </span><span class="n">btrfs</span><span class="w"> </span><span class="n">filesystem</span><span class="o">.</span></code></pre><p>SUBCOMMAND</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">chunk</span><span class="o">-</span><span class="n">recover</span><span class="w"> </span><span class="p" data-group-id="4466850181-1">[</span><span class="n">options</span><span class="p" data-group-id="4466850181-1">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">device</span><span class="o">&gt;</span><span class="w">
          </span><span class="nc">Recover</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">chunk</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">devices</span><span class="w">

          </span><span class="nc">Options</span><span class="w">

          </span><span class="o">-</span><span class="n">y</span><span class="w">     </span><span class="n">assume</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">answer</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">yes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">questions</span><span class="o">.</span><span class="w">

          </span><span class="o">-</span><span class="n">h</span><span class="w">     </span><span class="n">help</span><span class="o">.</span><span class="w">

          </span><span class="o">-</span><span class="n">v</span><span class="w">     </span><span class="p" data-group-id="4466850181-2">(</span><span class="n">deprecated</span><span class="p" data-group-id="4466850181-2">)</span><span class="w"> </span><span class="kn">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">option</span><span class="w">

   </span><span class="ss">NOTE</span><span class="p">:</span><span class="w">
      </span><span class="nc">Since</span><span class="w"> </span><span class="n">chunk</span><span class="o">-</span><span class="n">recover</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">whole</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">especially</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">device</span><span class="o">.</span><span class="w">

   </span><span class="n">fix</span><span class="o">-</span><span class="n">device</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;</span><span class="n">device</span><span class="o">&gt;</span><span class="w">
          </span><span class="n">fix</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">super</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k" data-group-id="4466850181-3">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">match</span><span class="w">

          </span><span class="nc">Kernel</span><span class="w">  </span><span class="mf">4.11</span><span class="w">  </span><span class="n">starts</span><span class="w">  </span><span class="n">to</span><span class="w">  </span><span class="n">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">strictly</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">bytes</span><span class="o">.</span><span class="w"> </span><span class="nc">See</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">below</span><span class="o">.</span><span class="w">  </span><span class="nc">Newer</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">will</span><span class="w">
          </span><span class="n">refuse</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k" data-group-id="4466850181-4">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">match</span><span class="o">.</span><span class="w">  </span><span class="nc">This</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">fatal</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fixed</span><span class="o">.</span><span class="w">  </span><span class="nc">This</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">fix</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span><span class="o">.</span><span class="w">

             </span><span class="nc">BTRFS</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="p" data-group-id="4466850181-5">(</span><span class="n">device</span><span class="w"> </span><span class="n">sdb</span><span class="p" data-group-id="4466850181-5">)</span><span class="p">:</span><span class="w"> </span><span class="n">super_total_bytes</span><span class="w"> </span><span class="mi">92017859088384</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">fs_devices</span><span class="w"> </span><span class="n">total_rw_bytes</span><span class="w"> </span><span class="mi">92017859094528</span><span class="w">

          </span><span class="nc">The</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">exhibit</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="ss">warning</span><span class="p">:</span><span class="w">

             </span><span class="ss">WARNING</span><span class="p">:</span><span class="w"> </span><span class="ss">CPU</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">PID</span><span class="p">:</span><span class="w"> </span><span class="mi">439</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fs</span><span class="o">/</span><span class="n">btrfs</span><span class="o">/</span><span class="n">ctree</span><span class="o">.</span><span class="n">h</span><span class="p">:</span><span class="mi">1559</span><span class="w"> </span><span class="n">btrfs_update_device</span><span class="o">+</span><span class="mh">0x1c5</span><span class="o">/</span><span class="mh">0x1d0</span><span class="w"> </span><span class="p" data-group-id="4466850181-6">[</span><span class="n">btrfs</span><span class="p" data-group-id="4466850181-6">]</span><span class="w">

   </span><span class="n">clear</span><span class="o">-</span><span class="n">uuid</span><span class="o">-</span><span class="n">tree</span><span class="w"> </span><span class="o">&lt;</span><span class="n">device</span><span class="o">&gt;</span><span class="w">
          </span><span class="nc">Clear</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">generate</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">write</span><span class="w"> </span><span class="n">mount</span><span class="o">.</span><span class="w">

          </span><span class="nc">Since</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">v4</span><span class="o">.</span><span class="mi">16</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">sanity</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">performed</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">critical</span><span class="w"> </span><span class="n">trees</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">reject</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mount</span><span class="o">.</span><span class="w">  </span><span class="nc">In</span><span class="w"> </span><span class="n">such</span><span class="w">  </span><span class="k">case</span><span class="p">,</span><span class="w">  </span><span class="n">clearing</span><span class="w">
          </span><span class="n">uuid</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">mountable</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">risk</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">it</span><span class="sc">&#39;s built from other trees.

   super-recover [options] &lt;device&gt;
          Recover bad superblocks from good copies.

          Options

          -y     assume an answer of yes to all questions.

          -v     (deprecated) alias for global -v option

   zero-log &lt;device&gt;
          clear the filesystem log tree

          This  command  will clear the filesystem log tree. This may fix a specific set of problem when the filesystem mount fails due to the log replay. See below for sample stack‐
          traces that may show up in system log.

          The common case where this happens was fixed a long time ago, so it is unlikely that you will see this particular problem, but the command is kept around.

          NOTE:
             Clearing the log may lead to loss of changes that were made since the last transaction commit. This may be up to 30 seconds (default commit period) or less if the commit
             was implied by other filesystem activity.

          One can determine whether zero-log is needed according to the kernel backtrace:

             ? replay_one_dir_item+0xb5/0xb5 [btrfs]
             ? walk_log_tree+0x9c/0x19d [btrfs]
             ? btrfs_read_fs_root_no_radix+0x169/0x1a1 [btrfs]
             ? btrfs_recover_log_trees+0x195/0x29c [btrfs]
             ? replay_one_dir_item+0xb5/0xb5 [btrfs]
             ? btree_read_extent_buffer_pages+0x76/0xbc [btrfs]
             ? open_ctree+0xff6/0x132c [btrfs]

          If  the  errors  are  like  above, then zero-log should be used to clear the log and the filesystem may be mounted normally again. The keywords to look for are &#39;</span><span class="n">open_ctree</span><span class="sc">&#39;
          which says that it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">replay</span><span class="p">,</span><span class="w"> </span><span class="n">recover</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">log_tree</span><span class="o">.</span></code></pre><p>EXIT STATUS</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">btrfs</span><span class="w"> </span><span class="k">rescue</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">succeeds</span><span class="o">.</span><span class="w"> </span><span class="nc">Non</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">failure</span><span class="o">.</span></code></pre><p>AVAILABILITY</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">btrfs</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">btrfs</span><span class="o">-</span><span class="n">progs</span><span class="o">.</span><span class="w">  </span><span class="nc">Please</span><span class="w"> </span><span class="n">refer</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">btrfs</span><span class="w"> </span><span class="n">wiki</span><span class="w"> </span><span class="n">http</span><span class="ss">://</span><span class="n">btrfs</span><span class="o">.</span><span class="n">wiki</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">org</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">further</span><span class="w"> </span><span class="n">details</span><span class="o">.</span></code></pre><p>SEE ALSO</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="n">mkfs</span><span class="o">.</span><span class="n">btrfs</span><span class="p" data-group-id="6815291436-1">(</span><span class="mi">8</span><span class="p" data-group-id="6815291436-1">)</span><span class="p">,</span><span class="w"> </span><span class="n">btrfs</span><span class="o">-</span><span class="n">scrub</span><span class="p" data-group-id="6815291436-2">(</span><span class="mi">8</span><span class="p" data-group-id="6815291436-2">)</span><span class="p">,</span><span class="w"> </span><span class="n">btrfs</span><span class="o">-</span><span class="n">check</span><span class="p" data-group-id="6815291436-3">(</span><span class="mi">8</span><span class="p" data-group-id="6815291436-3">)</span></code></pre><p>COPYRIGHT</p><pre><code class="makeup elixir" translate="no"><span class="w">   </span><span class="mi">2022</span></code></pre><p>5.18.1                                                                                 Jun 09, 2022                                                                        BTRFS-RESCUE(8)</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="btrfs-replace.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
btrfs-replace
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="btrfs-restore.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
btrfs-restore
        </span>
      </a>

  </div>
</div>

      <footer class="footer">

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.5) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
